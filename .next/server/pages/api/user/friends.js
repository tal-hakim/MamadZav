"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/user/friends";
exports.ids = ["pages/api/user/friends"];
exports.modules = {

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fuser%2Ffriends&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cuser%5Cfriends.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fuser%2Ffriends&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cuser%5Cfriends.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_user_friends_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\user\\friends.ts */ \"(api)/./src/pages/api/user/friends.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_user_friends_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_user_friends_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/user/friends\",\n        pathname: \"/api/user/friends\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_user_friends_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVzZXIlMkZmcmllbmRzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTVDcGFnZXMlNUNhcGklNUN1c2VyJTVDZnJpZW5kcy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNnRTtBQUNoRTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsMkRBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDJEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhZmV0eS1jaGVjay1uZXR3b3JrLz82ZTBhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9zcmNcXFxccGFnZXNcXFxcYXBpXFxcXHVzZXJcXFxcZnJpZW5kcy50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VzZXIvZnJpZW5kc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VzZXIvZnJpZW5kc1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fuser%2Ffriends&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cuser%5Cfriends.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nif (!MONGODB_URI) {\n    throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\");\n}\nlet cached = global.mongoose || {\n    conn: null,\n    promise: null\n};\nif (!global.mongoose) {\n    global.mongoose = cached;\n}\nasync function dbConnect() {\n    if (cached.conn) {\n        // Check if the connection is still valid\n        if ((mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection).readyState === 1) {\n            console.log(\"Using cached database connection\");\n            return cached.conn;\n        } else {\n            console.log(\"Cached connection is no longer valid, creating new connection...\");\n            cached.conn = null;\n            cached.promise = null;\n        }\n    }\n    if (!cached.promise) {\n        const opts = {\n            bufferCommands: false,\n            serverSelectionTimeoutMS: 10000,\n            socketTimeoutMS: 45000,\n            family: 4,\n            maxPoolSize: 10,\n            minPoolSize: 1,\n            connectTimeoutMS: 10000,\n            retryWrites: true,\n            retryReads: true\n        };\n        try {\n            console.log(\"Creating new database connection...\");\n            const mongooseInstance = (mongoose__WEBPACK_IMPORTED_MODULE_0___default());\n            cached.promise = mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(MONGODB_URI, opts).then(()=>{\n                console.log(\"MongoDB connected successfully\");\n                // Handle connection events\n                mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection.on(\"error\", (err)=>{\n                    console.error(\"MongoDB connection error:\", err);\n                    if ((mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection).readyState !== 1) {\n                        cached.conn = null;\n                        cached.promise = null;\n                    }\n                });\n                mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection.on(\"disconnected\", ()=>{\n                    console.warn(\"MongoDB disconnected\");\n                    if ((mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection).readyState !== 1) {\n                        cached.conn = null;\n                        cached.promise = null;\n                    }\n                });\n                mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection.on(\"connected\", ()=>{\n                    console.log(\"MongoDB connected\");\n                });\n                mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection.on(\"reconnected\", ()=>{\n                    console.log(\"MongoDB reconnected\");\n                    cached.conn = mongooseInstance;\n                });\n                // Enable debug mode for Mongoose operations in development\n                if (true) {\n                    mongoose__WEBPACK_IMPORTED_MODULE_0___default().set(\"debug\", true);\n                }\n                return mongooseInstance;\n            });\n        } catch (error) {\n            console.error(\"Error creating MongoDB connection:\", error);\n            cached.promise = null;\n            throw error;\n        }\n    } else {\n        console.log(\"Using existing connection promise\");\n    }\n    try {\n        console.log(\"Waiting for connection to be established...\");\n        const maxRetries = 3;\n        let retries = 0;\n        let lastError;\n        while(retries < maxRetries){\n            try {\n                cached.conn = await cached.promise;\n                console.log(\"Connection established successfully\");\n                return cached.conn;\n            } catch (error) {\n                lastError = error;\n                retries++;\n                console.error(`Failed to establish connection (attempt ${retries}/${maxRetries}):`, error);\n                if (retries < maxRetries) {\n                    console.log(`Retrying in ${retries * 2} seconds...`);\n                    await new Promise((resolve)=>setTimeout(resolve, retries * 2000));\n                    cached.promise = null;\n                }\n            }\n        }\n        console.error(\"Max retries reached, could not establish connection\");\n        throw lastError;\n    } catch (error) {\n        console.error(\"Error establishing MongoDB connection:\", error);\n        cached.promise = null;\n        throw error;\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (dbConnect);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUssQ0FBQyxDQUFDLHdDQUF3QyxFQUFFSSxRQUFRLENBQUMsRUFBRUQsV0FBVyxFQUFFLENBQUMsRUFBRUg7Z0JBRXBGLElBQUlJLFVBQVVELFlBQVk7b0JBQ3hCcEIsUUFBUUMsR0FBRyxDQUFDLENBQUMsWUFBWSxFQUFFb0IsVUFBVSxFQUFFLFdBQVcsQ0FBQztvQkFDbkQsTUFBTSxJQUFJRSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTSCxVQUFVO29CQUMzRDVCLE9BQU9HLE9BQU8sR0FBRztnQkFDbkI7WUFDRjtRQUNGO1FBRUFJLFFBQVFpQixLQUFLLENBQUM7UUFDZCxNQUFNSztJQUNSLEVBQUUsT0FBT0wsT0FBTztRQUNkakIsUUFBUWlCLEtBQUssQ0FBQywwQ0FBMENBO1FBQ3hEeEIsT0FBT0csT0FBTyxHQUFHO1FBQ2pCLE1BQU1xQjtJQUNSO0FBQ0Y7QUFFQSxpRUFBZXBCLFNBQVNBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWZldHktY2hlY2stbmV0d29yay8uL3NyYy9saWIvZGIudHM/OWU0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xyXG5cclxudHlwZSBDYWNoZWRNb25nb29zZSA9IHtcclxuICBjb25uOiB0eXBlb2YgbW9uZ29vc2UgfCBudWxsO1xyXG4gIHByb21pc2U6IFByb21pc2U8dHlwZW9mIG1vbmdvb3NlPiB8IG51bGw7XHJcbn07XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgdmFyIG1vbmdvb3NlOiBDYWNoZWRNb25nb29zZSB8IHVuZGVmaW5lZDtcclxufVxyXG5cclxuY29uc3QgTU9OR09EQl9VUkkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuXHJcbmlmICghTU9OR09EQl9VUkkpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBkZWZpbmUgdGhlIE1PTkdPREJfVVJJIGVudmlyb25tZW50IHZhcmlhYmxlIGluc2lkZSAuZW52LmxvY2FsJyk7XHJcbn1cclxuXHJcbmxldCBjYWNoZWQgPSBnbG9iYWwubW9uZ29vc2UgfHwgeyBjb25uOiBudWxsLCBwcm9taXNlOiBudWxsIH07XHJcblxyXG5pZiAoIWdsb2JhbC5tb25nb29zZSkge1xyXG4gIGdsb2JhbC5tb25nb29zZSA9IGNhY2hlZDtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZGJDb25uZWN0KCkge1xyXG4gIGlmIChjYWNoZWQuY29ubikge1xyXG4gICAgLy8gQ2hlY2sgaWYgdGhlIGNvbm5lY3Rpb24gaXMgc3RpbGwgdmFsaWRcclxuICAgIGlmIChtb25nb29zZS5jb25uZWN0aW9uLnJlYWR5U3RhdGUgPT09IDEpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1VzaW5nIGNhY2hlZCBkYXRhYmFzZSBjb25uZWN0aW9uJyk7XHJcbiAgICAgIHJldHVybiBjYWNoZWQuY29ubjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdDYWNoZWQgY29ubmVjdGlvbiBpcyBubyBsb25nZXIgdmFsaWQsIGNyZWF0aW5nIG5ldyBjb25uZWN0aW9uLi4uJyk7XHJcbiAgICAgIGNhY2hlZC5jb25uID0gbnVsbDtcclxuICAgICAgY2FjaGVkLnByb21pc2UgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKCFjYWNoZWQucHJvbWlzZSkge1xyXG4gICAgY29uc3Qgb3B0cyA9IHtcclxuICAgICAgYnVmZmVyQ29tbWFuZHM6IGZhbHNlLFxyXG4gICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLCAvLyBJbmNyZWFzZWQgdGltZW91dCB0byAxMCBzZWNvbmRzXHJcbiAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsIC8vIENsb3NlIHNvY2tldHMgYWZ0ZXIgNDUgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XHJcbiAgICAgIGZhbWlseTogNCwgLy8gVXNlIElQdjQsIHNraXAgdHJ5aW5nIElQdjZcclxuICAgICAgbWF4UG9vbFNpemU6IDEwLFxyXG4gICAgICBtaW5Qb29sU2l6ZTogMSxcclxuICAgICAgY29ubmVjdFRpbWVvdXRNUzogMTAwMDAsXHJcbiAgICAgIHJldHJ5V3JpdGVzOiB0cnVlLFxyXG4gICAgICByZXRyeVJlYWRzOiB0cnVlLFxyXG4gICAgfTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgbmV3IGRhdGFiYXNlIGNvbm5lY3Rpb24uLi4nKTtcclxuICAgICAgY29uc3QgbW9uZ29vc2VJbnN0YW5jZSA9IG1vbmdvb3NlO1xyXG4gICAgICBjYWNoZWQucHJvbWlzZSA9IG1vbmdvb3NlLmNvbm5lY3QoTU9OR09EQl9VUkkhLCBvcHRzKS50aGVuKCgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnTW9uZ29EQiBjb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcblxyXG4gICAgICAgIC8vIEhhbmRsZSBjb25uZWN0aW9uIGV2ZW50c1xyXG4gICAgICAgIG1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGVycm9yOicsIGVycik7XHJcbiAgICAgICAgICBpZiAobW9uZ29vc2UuY29ubmVjdGlvbi5yZWFkeVN0YXRlICE9PSAxKSB7XHJcbiAgICAgICAgICAgIGNhY2hlZC5jb25uID0gbnVsbDtcclxuICAgICAgICAgICAgY2FjaGVkLnByb21pc2UgPSBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ01vbmdvREIgZGlzY29ubmVjdGVkJyk7XHJcbiAgICAgICAgICBpZiAobW9uZ29vc2UuY29ubmVjdGlvbi5yZWFkeVN0YXRlICE9PSAxKSB7XHJcbiAgICAgICAgICAgIGNhY2hlZC5jb25uID0gbnVsbDtcclxuICAgICAgICAgICAgY2FjaGVkLnByb21pc2UgPSBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnTW9uZ29EQiBjb25uZWN0ZWQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbW9uZ29vc2UuY29ubmVjdGlvbi5vbigncmVjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnTW9uZ29EQiByZWNvbm5lY3RlZCcpO1xyXG4gICAgICAgICAgY2FjaGVkLmNvbm4gPSBtb25nb29zZUluc3RhbmNlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBFbmFibGUgZGVidWcgbW9kZSBmb3IgTW9uZ29vc2Ugb3BlcmF0aW9ucyBpbiBkZXZlbG9wbWVudFxyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICBtb25nb29zZS5zZXQoJ2RlYnVnJywgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbW9uZ29vc2VJbnN0YW5jZTtcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBNb25nb0RCIGNvbm5lY3Rpb246JywgZXJyb3IpO1xyXG4gICAgICBjYWNoZWQucHJvbWlzZSA9IG51bGw7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zb2xlLmxvZygnVXNpbmcgZXhpc3RpbmcgY29ubmVjdGlvbiBwcm9taXNlJyk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ1dhaXRpbmcgZm9yIGNvbm5lY3Rpb24gdG8gYmUgZXN0YWJsaXNoZWQuLi4nKTtcclxuICAgIGNvbnN0IG1heFJldHJpZXMgPSAzO1xyXG4gICAgbGV0IHJldHJpZXMgPSAwO1xyXG4gICAgbGV0IGxhc3RFcnJvcjtcclxuXHJcbiAgICB3aGlsZSAocmV0cmllcyA8IG1heFJldHJpZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjYWNoZWQuY29ubiA9IGF3YWl0IGNhY2hlZC5wcm9taXNlO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIGVzdGFibGlzaGVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICAgIHJldHVybiBjYWNoZWQuY29ubjtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBsYXN0RXJyb3IgPSBlcnJvcjtcclxuICAgICAgICByZXRyaWVzKys7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGVzdGFibGlzaCBjb25uZWN0aW9uIChhdHRlbXB0ICR7cmV0cmllc30vJHttYXhSZXRyaWVzfSk6YCwgZXJyb3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyZXRyaWVzIDwgbWF4UmV0cmllcykge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYFJldHJ5aW5nIGluICR7cmV0cmllcyAqIDJ9IHNlY29uZHMuLi5gKTtcclxuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCByZXRyaWVzICogMjAwMCkpO1xyXG4gICAgICAgICAgY2FjaGVkLnByb21pc2UgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUuZXJyb3IoJ01heCByZXRyaWVzIHJlYWNoZWQsIGNvdWxkIG5vdCBlc3RhYmxpc2ggY29ubmVjdGlvbicpO1xyXG4gICAgdGhyb3cgbGFzdEVycm9yO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlc3RhYmxpc2hpbmcgTW9uZ29EQiBjb25uZWN0aW9uOicsIGVycm9yKTtcclxuICAgIGNhY2hlZC5wcm9taXNlID0gbnVsbDtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZGJDb25uZWN0OyAiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJNT05HT0RCX1VSSSIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsImNhY2hlZCIsImdsb2JhbCIsImNvbm4iLCJwcm9taXNlIiwiZGJDb25uZWN0IiwiY29ubmVjdGlvbiIsInJlYWR5U3RhdGUiLCJjb25zb2xlIiwibG9nIiwib3B0cyIsImJ1ZmZlckNvbW1hbmRzIiwic2VydmVyU2VsZWN0aW9uVGltZW91dE1TIiwic29ja2V0VGltZW91dE1TIiwiZmFtaWx5IiwibWF4UG9vbFNpemUiLCJtaW5Qb29sU2l6ZSIsImNvbm5lY3RUaW1lb3V0TVMiLCJyZXRyeVdyaXRlcyIsInJldHJ5UmVhZHMiLCJtb25nb29zZUluc3RhbmNlIiwiY29ubmVjdCIsInRoZW4iLCJvbiIsImVyciIsImVycm9yIiwid2FybiIsInNldCIsIm1heFJldHJpZXMiLCJyZXRyaWVzIiwibGFzdEVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/db.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/auth.ts":
/*!********************************!*\
  !*** ./src/middleware/auth.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authMiddleware: () => (/* binding */ authMiddleware),\n/* harmony export */   generateToken: () => (/* binding */ generateToken)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _models_User__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/models/User */ \"(api)/./src/models/User.ts\");\n\n\nconst JWT_SECRET = process.env.JWT_SECRET;\nif (!JWT_SECRET) {\n    throw new Error(\"Please define the JWT_SECRET environment variable inside .env.local\");\n}\nasync function authMiddleware(req, res, next) {\n    try {\n        const authHeader = req.headers.authorization;\n        if (!authHeader?.startsWith(\"Bearer \")) {\n            return res.status(401).json({\n                message: \"No token provided\"\n            });\n        }\n        const token = authHeader.split(\" \")[1];\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET);\n        const user = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findById(decoded.id).select(\"-password\");\n        if (!user) {\n            return res.status(401).json({\n                message: \"User not found\"\n            });\n        }\n        req.user = user;\n        next();\n    } catch (error) {\n        return res.status(401).json({\n            message: \"Invalid token\"\n        });\n    }\n}\nfunction generateToken(userId) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign({\n        id: userId\n    }, JWT_SECRET, {\n        expiresIn: \"7d\"\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWlkZGxld2FyZS9hdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQytCO0FBQ2E7QUFFNUMsTUFBTUUsYUFBYUMsUUFBUUMsR0FBRyxDQUFDRixVQUFVO0FBRXpDLElBQUksQ0FBQ0EsWUFBWTtJQUNmLE1BQU0sSUFBSUcsTUFBTTtBQUNsQjtBQU1PLGVBQWVDLGVBQ3BCQyxHQUF5QixFQUN6QkMsR0FBb0IsRUFDcEJDLElBQWdCO0lBRWhCLElBQUk7UUFDRixNQUFNQyxhQUFhSCxJQUFJSSxPQUFPLENBQUNDLGFBQWE7UUFFNUMsSUFBSSxDQUFDRixZQUFZRyxXQUFXLFlBQVk7WUFDdEMsT0FBT0wsSUFBSU0sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUFvQjtRQUM3RDtRQUVBLE1BQU1DLFFBQVFQLFdBQVdRLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUN0QyxNQUFNQyxVQUFVbkIsMERBQVUsQ0FBQ2lCLE9BQU9mO1FBRWxDLE1BQU1tQixPQUFPLE1BQU1wQiw4Q0FBSUEsQ0FBQ3FCLFFBQVEsQ0FBQ0gsUUFBUUksRUFBRSxFQUFFQyxNQUFNLENBQUM7UUFDcEQsSUFBSSxDQUFDSCxNQUFNO1lBQ1QsT0FBT2IsSUFBSU0sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztZQUFpQjtRQUMxRDtRQUVBVCxJQUFJYyxJQUFJLEdBQUdBO1FBQ1haO0lBQ0YsRUFBRSxPQUFPZ0IsT0FBTztRQUNkLE9BQU9qQixJQUFJTSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBZ0I7SUFDekQ7QUFDRjtBQUVPLFNBQVNVLGNBQWNDLE1BQWM7SUFDMUMsT0FBTzNCLHdEQUFRLENBQUM7UUFBRXVCLElBQUlJO0lBQU8sR0FBR3pCLFlBQVk7UUFBRTJCLFdBQVc7SUFBSztBQUNoRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NhZmV0eS1jaGVjay1uZXR3b3JrLy4vc3JjL21pZGRsZXdhcmUvYXV0aC50cz9iOWFkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xyXG5pbXBvcnQgeyBVc2VyLCBJVXNlciB9IGZyb20gJ0AvbW9kZWxzL1VzZXInO1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQ7XHJcblxyXG5pZiAoIUpXVF9TRUNSRVQpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBkZWZpbmUgdGhlIEpXVF9TRUNSRVQgZW52aXJvbm1lbnQgdmFyaWFibGUgaW5zaWRlIC5lbnYubG9jYWwnKTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBdXRoZW50aWNhdGVkUmVxdWVzdCBleHRlbmRzIE5leHRBcGlSZXF1ZXN0IHtcclxuICB1c2VyPzogSVVzZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRoTWlkZGxld2FyZShcclxuICByZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LFxyXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlLFxyXG4gIG5leHQ6ICgpID0+IHZvaWRcclxuKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG5cclxuICAgIGlmICghYXV0aEhlYWRlcj8uc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdObyB0b2tlbiBwcm92aWRlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07XHJcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCkgYXMgeyBpZDogc3RyaW5nIH07XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQoZGVjb2RlZC5pZCkuc2VsZWN0KCctcGFzc3dvcmQnKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcS51c2VyID0gdXNlcjtcclxuICAgIG5leHQoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0ludmFsaWQgdG9rZW4nIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW4odXNlcklkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIHJldHVybiBqd3Quc2lnbih7IGlkOiB1c2VySWQgfSwgSldUX1NFQ1JFVCwgeyBleHBpcmVzSW46ICc3ZCcgfSk7XHJcbn0gIl0sIm5hbWVzIjpbImp3dCIsIlVzZXIiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkVycm9yIiwiYXV0aE1pZGRsZXdhcmUiLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhcnRzV2l0aCIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwidG9rZW4iLCJzcGxpdCIsImRlY29kZWQiLCJ2ZXJpZnkiLCJ1c2VyIiwiZmluZEJ5SWQiLCJpZCIsInNlbGVjdCIsImVycm9yIiwiZ2VuZXJhdGVUb2tlbiIsInVzZXJJZCIsInNpZ24iLCJleHBpcmVzSW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/middleware/auth.ts\n");

/***/ }),

/***/ "(api)/./src/models/User.ts":
/*!****************************!*\
  !*** ./src/models/User.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   User: () => (/* binding */ User)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst userSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    email: {\n        type: String,\n        required: true,\n        unique: true,\n        trim: true,\n        lowercase: true\n    },\n    username: {\n        type: String,\n        required: true,\n        unique: true,\n        trim: true,\n        lowercase: true,\n        minlength: 3,\n        maxlength: 30,\n        match: [\n            /^[a-zA-Z0-9_]+$/,\n            \"Username can only contain letters, numbers and underscores\"\n        ]\n    },\n    password: {\n        type: String,\n        required: true,\n        minlength: 6\n    },\n    name: {\n        type: String,\n        required: true,\n        trim: true\n    },\n    friends: [\n        {\n            type: (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema).Types.ObjectId,\n            ref: \"User\"\n        }\n    ],\n    friendRequests: [\n        {\n            from: {\n                type: (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema).Types.ObjectId,\n                ref: \"User\",\n                required: true\n            },\n            createdAt: {\n                type: Date,\n                default: Date.now\n            }\n        }\n    ],\n    lastCheckIn: {\n        type: Date,\n        default: null\n    }\n}, {\n    timestamps: true\n});\n// Hash password before saving\nuserSchema.pre(\"save\", async function(next) {\n    if (!this.isModified(\"password\")) return next();\n    try {\n        const salt = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().genSalt(10);\n        this.password = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(this.password, salt);\n        next();\n    } catch (error) {\n        next(error);\n    }\n});\n// Compare password method\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(candidatePassword, this.password);\n};\nconst User = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).User || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"User\", userSchema);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbW9kZWxzL1VzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBZ0M7QUFDRjtBQWdCOUIsTUFBTUUsYUFBYSxJQUFJRix3REFBZSxDQUFDO0lBQ3JDSSxPQUFPO1FBQ0xDLE1BQU1DO1FBQ05DLFVBQVU7UUFDVkMsUUFBUTtRQUNSQyxNQUFNO1FBQ05DLFdBQVc7SUFDYjtJQUNBQyxVQUFVO1FBQ1JOLE1BQU1DO1FBQ05DLFVBQVU7UUFDVkMsUUFBUTtRQUNSQyxNQUFNO1FBQ05DLFdBQVc7UUFDWEUsV0FBVztRQUNYQyxXQUFXO1FBQ1hDLE9BQU87WUFBQztZQUFtQjtTQUE2RDtJQUMxRjtJQUNBQyxVQUFVO1FBQ1JWLE1BQU1DO1FBQ05DLFVBQVU7UUFDVkssV0FBVztJQUNiO0lBQ0FJLE1BQU07UUFDSlgsTUFBTUM7UUFDTkMsVUFBVTtRQUNWRSxNQUFNO0lBQ1I7SUFDQVEsU0FBUztRQUFDO1lBQ1JaLE1BQU1MLHdEQUFlLENBQUNrQixLQUFLLENBQUNDLFFBQVE7WUFDcENDLEtBQUs7UUFDUDtLQUFFO0lBQ0ZDLGdCQUFnQjtRQUFDO1lBQ2ZDLE1BQU07Z0JBQ0pqQixNQUFNTCx3REFBZSxDQUFDa0IsS0FBSyxDQUFDQyxRQUFRO2dCQUNwQ0MsS0FBSztnQkFDTGIsVUFBVTtZQUNaO1lBQ0FnQixXQUFXO2dCQUNUbEIsTUFBTW1CO2dCQUNOQyxTQUFTRCxLQUFLRSxHQUFHO1lBQ25CO1FBQ0Y7S0FBRTtJQUNGQyxhQUFhO1FBQ1h0QixNQUFNbUI7UUFDTkMsU0FBUztJQUNYO0FBQ0YsR0FBRztJQUNERyxZQUFZO0FBQ2Q7QUFFQSw4QkFBOEI7QUFDOUIxQixXQUFXMkIsR0FBRyxDQUFDLFFBQVEsZUFBZUMsSUFBSTtJQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDQyxVQUFVLENBQUMsYUFBYSxPQUFPRDtJQUV6QyxJQUFJO1FBQ0YsTUFBTUUsT0FBTyxNQUFNL0IsdURBQWMsQ0FBQztRQUNsQyxJQUFJLENBQUNjLFFBQVEsR0FBRyxNQUFNZCxvREFBVyxDQUFDLElBQUksQ0FBQ2MsUUFBUSxFQUFFaUI7UUFDakRGO0lBQ0YsRUFBRSxPQUFPSyxPQUFPO1FBQ2RMLEtBQUtLO0lBQ1A7QUFDRjtBQUVBLDBCQUEwQjtBQUMxQmpDLFdBQVdrQyxPQUFPLENBQUNDLGVBQWUsR0FBRyxlQUFlQyxpQkFBeUI7SUFDM0UsT0FBT3JDLHVEQUFjLENBQUNxQyxtQkFBbUIsSUFBSSxDQUFDdkIsUUFBUTtBQUN4RDtBQUVPLE1BQU15QixPQUFPeEMsd0RBQWUsQ0FBQ3dDLElBQUksSUFBSXhDLHFEQUFjLENBQVEsUUFBUUUsWUFBWSIsInNvdXJjZXMiOlsid2VicGFjazovL3NhZmV0eS1jaGVjay1uZXR3b3JrLy4vc3JjL21vZGVscy9Vc2VyLnRzPzA5NmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcclxuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElVc2VyIGV4dGVuZHMgbW9uZ29vc2UuRG9jdW1lbnQge1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgcGFzc3dvcmQ6IHN0cmluZztcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgdXNlcm5hbWU6IHN0cmluZztcclxuICBmcmllbmRzOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZFtdO1xyXG4gIGZyaWVuZFJlcXVlc3RzOiB7XHJcbiAgICBmcm9tOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZDtcclxuICAgIGNyZWF0ZWRBdDogRGF0ZTtcclxuICB9W107XHJcbiAgbGFzdENoZWNrSW46IERhdGUgfCBudWxsO1xyXG4gIGNvbXBhcmVQYXNzd29yZChjYW5kaWRhdGVQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPjtcclxufVxyXG5cclxuY29uc3QgdXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gIGVtYWlsOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgIHVuaXF1ZTogdHJ1ZSxcclxuICAgIHRyaW06IHRydWUsXHJcbiAgICBsb3dlcmNhc2U6IHRydWUsXHJcbiAgfSxcclxuICB1c2VybmFtZToge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICB1bmlxdWU6IHRydWUsXHJcbiAgICB0cmltOiB0cnVlLFxyXG4gICAgbG93ZXJjYXNlOiB0cnVlLFxyXG4gICAgbWlubGVuZ3RoOiAzLFxyXG4gICAgbWF4bGVuZ3RoOiAzMCxcclxuICAgIG1hdGNoOiBbL15bYS16QS1aMC05X10rJC8sICdVc2VybmFtZSBjYW4gb25seSBjb250YWluIGxldHRlcnMsIG51bWJlcnMgYW5kIHVuZGVyc2NvcmVzJ11cclxuICB9LFxyXG4gIHBhc3N3b3JkOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgIG1pbmxlbmd0aDogNixcclxuICB9LFxyXG4gIG5hbWU6IHtcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgdHJpbTogdHJ1ZSxcclxuICB9LFxyXG4gIGZyaWVuZHM6IFt7XHJcbiAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICByZWY6ICdVc2VyJyxcclxuICB9XSxcclxuICBmcmllbmRSZXF1ZXN0czogW3tcclxuICAgIGZyb206IHtcclxuICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBjcmVhdGVkQXQ6IHtcclxuICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgIH1cclxuICB9XSxcclxuICBsYXN0Q2hlY2tJbjoge1xyXG4gICAgdHlwZTogRGF0ZSxcclxuICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgfSxcclxufSwge1xyXG4gIHRpbWVzdGFtcHM6IHRydWUsXHJcbn0pO1xyXG5cclxuLy8gSGFzaCBwYXNzd29yZCBiZWZvcmUgc2F2aW5nXHJcbnVzZXJTY2hlbWEucHJlKCdzYXZlJywgYXN5bmMgZnVuY3Rpb24obmV4dCkge1xyXG4gIGlmICghdGhpcy5pc01vZGlmaWVkKCdwYXNzd29yZCcpKSByZXR1cm4gbmV4dCgpO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2FsdCA9IGF3YWl0IGJjcnlwdC5nZW5TYWx0KDEwKTtcclxuICAgIHRoaXMucGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaCh0aGlzLnBhc3N3b3JkLCBzYWx0KTtcclxuICAgIG5leHQoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgbmV4dChlcnJvciBhcyBFcnJvcik7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIENvbXBhcmUgcGFzc3dvcmQgbWV0aG9kXHJcbnVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBhc3luYyBmdW5jdGlvbihjYW5kaWRhdGVQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKGNhbmRpZGF0ZVBhc3N3b3JkLCB0aGlzLnBhc3N3b3JkKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBVc2VyID0gbW9uZ29vc2UubW9kZWxzLlVzZXIgfHwgbW9uZ29vc2UubW9kZWw8SVVzZXI+KCdVc2VyJywgdXNlclNjaGVtYSk7ICJdLCJuYW1lcyI6WyJtb25nb29zZSIsImJjcnlwdCIsInVzZXJTY2hlbWEiLCJTY2hlbWEiLCJlbWFpbCIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInVuaXF1ZSIsInRyaW0iLCJsb3dlcmNhc2UiLCJ1c2VybmFtZSIsIm1pbmxlbmd0aCIsIm1heGxlbmd0aCIsIm1hdGNoIiwicGFzc3dvcmQiLCJuYW1lIiwiZnJpZW5kcyIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJmcmllbmRSZXF1ZXN0cyIsImZyb20iLCJjcmVhdGVkQXQiLCJEYXRlIiwiZGVmYXVsdCIsIm5vdyIsImxhc3RDaGVja0luIiwidGltZXN0YW1wcyIsInByZSIsIm5leHQiLCJpc01vZGlmaWVkIiwic2FsdCIsImdlblNhbHQiLCJoYXNoIiwiZXJyb3IiLCJtZXRob2RzIiwiY29tcGFyZVBhc3N3b3JkIiwiY2FuZGlkYXRlUGFzc3dvcmQiLCJjb21wYXJlIiwiVXNlciIsIm1vZGVscyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/models/User.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/user/friends.ts":
/*!***************************************!*\
  !*** ./src/pages/api/user/friends.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ withAuth)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var _models_User__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/models/User */ \"(api)/./src/models/User.ts\");\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/middleware/auth */ \"(api)/./src/middleware/auth.ts\");\n\n\n\nasync function handler(req, res) {\n    console.log(\"Friends API called with method:\", req.method);\n    if (![\n        \"GET\",\n        \"POST\",\n        \"DELETE\",\n        \"PUT\"\n    ].includes(req.method || \"\")) {\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    }\n    try {\n        // Connect to database\n        try {\n            console.log(\"Attempting to connect to MongoDB...\");\n            await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n            console.log(\"Successfully connected to MongoDB\");\n        } catch (error) {\n            console.error(\"Database connection error:\", error);\n            return res.status(500).json({\n                message: \"Database connection failed\",\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            });\n        }\n        if (!req.user) {\n            console.log(\"No user found in request\");\n            return res.status(401).json({\n                message: \"Not authenticated\"\n            });\n        }\n        console.log(\"User found in request:\", req.user._id);\n        const user = req.user;\n        // GET: Fetch friends list and friend requests\n        if (req.method === \"GET\") {\n            try {\n                // First try to find the user without population to ensure they exist\n                console.log(\"Looking up user:\", user._id);\n                const userExists = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findById(user._id);\n                if (!userExists) {\n                    console.error(\"User not found in database:\", user._id);\n                    return res.status(404).json({\n                        message: \"User not found\"\n                    });\n                }\n                console.log(\"Found user in database\");\n                // Then populate the data\n                console.log(\"Populating user data...\");\n                const userWithData = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findById(user._id).populate({\n                    path: \"friends\",\n                    select: \"name email username lastCheckIn\"\n                }).populate({\n                    path: \"friendRequests.from\",\n                    select: \"name email username\"\n                }).select(\"friends friendRequests\").lean();\n                if (!userWithData) {\n                    console.error(\"Failed to populate user data:\", user._id);\n                    return res.status(500).json({\n                        message: \"Failed to fetch user data\"\n                    });\n                }\n                console.log(\"Successfully populated user data\");\n                // Safely map friends with error handling\n                console.log(\"Raw friends data:\", userWithData.friends);\n                const friends = (userWithData.friends || []).filter((friend)=>friend && friend._id).map((friend)=>({\n                        id: friend._id.toString(),\n                        name: friend.name,\n                        username: friend.username,\n                        email: friend.email,\n                        lastCheckIn: friend.lastCheckIn\n                    }));\n                console.log(\"Processed friends:\", friends.length);\n                // Safely map friend requests with error handling\n                console.log(\"Raw friend requests data:\", userWithData.friendRequests);\n                const friendRequests = (userWithData.friendRequests || []).filter((request)=>request && request.from && request.from._id).map((request)=>({\n                        id: request.from._id.toString(),\n                        name: request.from.name,\n                        username: request.from.username,\n                        email: request.from.email,\n                        createdAt: request.createdAt\n                    }));\n                console.log(\"Processed friend requests:\", friendRequests.length);\n                return res.status(200).json({\n                    friends,\n                    friendRequests\n                });\n            } catch (error) {\n                console.error(\"Error fetching friends and requests:\", error);\n                return res.status(500).json({\n                    message: \"Error fetching friends and requests\",\n                    error: error instanceof Error ? error.message : \"Unknown error\"\n                });\n            }\n        }\n        const { username } = req.body;\n        if (!username) {\n            return res.status(400).json({\n                message: \"Username is required\"\n            });\n        }\n        // POST: Send a friend request\n        if (req.method === \"POST\") {\n            try {\n                // Check if friend exists\n                const friend = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findOne({\n                    username: username.toLowerCase()\n                });\n                if (!friend) {\n                    return res.status(404).json({\n                        message: \"User not found\"\n                    });\n                }\n                // Can't add yourself\n                if (friend._id.toString() === user._id.toString()) {\n                    return res.status(400).json({\n                        message: \"Cannot add yourself as a friend\"\n                    });\n                }\n                // Check if already friends\n                const areFriends = user.friends.some((friendId)=>friendId.toString() === friend._id.toString());\n                if (areFriends) {\n                    return res.status(400).json({\n                        message: \"Already friends\"\n                    });\n                }\n                // Check if friend request already sent\n                const existingRequest = friend.friendRequests.find((request)=>request.from.toString() === user._id.toString());\n                if (existingRequest) {\n                    return res.status(400).json({\n                        message: \"Friend request already sent\"\n                    });\n                }\n                // Check if they sent you a request\n                const theirRequest = user.friendRequests.find((request)=>request.from.toString() === friend._id.toString());\n                if (theirRequest) {\n                    return res.status(400).json({\n                        message: \"This user has already sent you a friend request. Check your friend requests to accept it.\"\n                    });\n                }\n                // Add friend request\n                await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(friend._id, {\n                    $push: {\n                        friendRequests: {\n                            from: user._id,\n                            createdAt: new Date()\n                        }\n                    }\n                }, {\n                    new: true\n                });\n                return res.status(200).json({\n                    message: \"Friend request sent successfully\"\n                });\n            } catch (error) {\n                console.error(\"Error sending friend request:\", error);\n                return res.status(500).json({\n                    message: \"Error sending friend request\"\n                });\n            }\n        }\n        // PUT: Accept a friend request\n        if (req.method === \"PUT\") {\n            try {\n                console.log(\"\\n=== START: Friend Request Acceptance ===\");\n                console.log(\"Raw request body:\", JSON.stringify(req.body));\n                console.log(\"Username from request:\", username);\n                console.log(\"Current user ID:\", user._id);\n                // First get the fully populated user document\n                console.log(\"\\nFetching current user with populated data...\");\n                const currentUser = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findById(user._id).populate({\n                    path: \"friendRequests.from\",\n                    select: \"name email username\"\n                }).lean().exec();\n                if (!currentUser) {\n                    console.error(\"Could not find current user with populated data\");\n                    return res.status(500).json({\n                        message: \"Error loading user data\"\n                    });\n                }\n                // Log the full user object for debugging\n                console.log(\"\\nCurrent user data:\", JSON.stringify({\n                    _id: currentUser._id,\n                    friendRequests: currentUser.friendRequests\n                }, null, 2));\n                console.log(\"\\nLooking for friend with username:\", username);\n                const friend = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findOne({\n                    username: username.toLowerCase()\n                });\n                if (!friend) {\n                    console.log(\"Friend not found with username:\", username);\n                    return res.status(404).json({\n                        message: \"User not found\"\n                    });\n                }\n                console.log(\"Found friend:\", {\n                    id: friend._id,\n                    username: friend.username\n                });\n                // Check if there's a pending request by comparing usernames\n                console.log(\"\\nChecking for pending request...\");\n                console.log(\"Number of friend requests:\", currentUser.friendRequests?.length || 0);\n                const pendingRequest = currentUser.friendRequests?.find((request)=>{\n                    const matches = request.from.username.toLowerCase() === username.toLowerCase();\n                    console.log(\"Checking request:\", {\n                        fromUsername: request.from.username,\n                        targetUsername: username,\n                        matches\n                    });\n                    return matches;\n                });\n                if (!pendingRequest) {\n                    console.log(\"\\nNo pending request found. All current requests:\", JSON.stringify(currentUser.friendRequests?.map((r)=>({\n                            fromUsername: r.from.username,\n                            fromId: r.from._id\n                        })), null, 2));\n                    return res.status(400).json({\n                        message: \"No friend request found from this user\"\n                    });\n                }\n                console.log(\"\\nFound pending request:\", {\n                    from: {\n                        id: pendingRequest.from._id,\n                        username: pendingRequest.from.username\n                    }\n                });\n                // Remove the request and add to friends for both users\n                console.log(\"\\nUpdating both users...\");\n                console.log(\"Update query:\", JSON.stringify({\n                    $pull: {\n                        \"friendRequests\": {\n                            \"from\": friend._id\n                        }\n                    },\n                    $addToSet: {\n                        friends: friend._id\n                    }\n                }, null, 2));\n                const [updatedUser, updatedFriend] = await Promise.all([\n                    _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(currentUser._id, {\n                        $pull: {\n                            \"friendRequests\": {\n                                \"from\": friend._id\n                            }\n                        },\n                        $addToSet: {\n                            friends: friend._id\n                        }\n                    }, {\n                        new: true,\n                        runValidators: true\n                    }).populate(\"friends\", \"name email username lastCheckIn\"),\n                    _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(friend._id, {\n                        $addToSet: {\n                            friends: currentUser._id\n                        }\n                    }, {\n                        new: true,\n                        runValidators: true\n                    })\n                ]);\n                if (!updatedUser || !updatedFriend) {\n                    console.error(\"\\nFailed to update documents:\", {\n                        updatedUser: !!updatedUser,\n                        updatedFriend: !!updatedFriend\n                    });\n                    throw new Error(\"Failed to update user or friend\");\n                }\n                console.log(\"\\nSuccessfully updated both users\");\n                console.log(\"Updated user friends:\", updatedUser.friends);\n                console.log(\"=== END: Friend Request Acceptance ===\\n\");\n                return res.status(200).json({\n                    message: \"Friend request accepted\",\n                    friend: {\n                        id: friend._id,\n                        name: friend.name,\n                        username: friend.username,\n                        email: friend.email,\n                        lastCheckIn: friend.lastCheckIn\n                    }\n                });\n            } catch (error) {\n                console.error(\"Error accepting friend request:\", error);\n                return res.status(500).json({\n                    message: \"Error accepting friend request\"\n                });\n            }\n        }\n        // DELETE: Reject a friend request or remove a friend\n        if (req.method === \"DELETE\") {\n            try {\n                const friend = await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findOne({\n                    username: username.toLowerCase()\n                });\n                if (!friend) {\n                    return res.status(404).json({\n                        message: \"User not found\"\n                    });\n                }\n                // Check if it's a friend request rejection\n                const requestIndex = user.friendRequests.findIndex((request)=>request.from.toString() === friend._id.toString());\n                if (requestIndex !== -1) {\n                    // Reject friend request\n                    await _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(user._id, {\n                        $pull: {\n                            friendRequests: {\n                                from: friend._id\n                            }\n                        }\n                    }, {\n                        new: true\n                    });\n                    return res.status(200).json({\n                        message: \"Friend request rejected\"\n                    });\n                }\n                // If not a request, remove from friends list\n                const [updatedUser, updatedFriend] = await Promise.all([\n                    _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(user._id, {\n                        $pull: {\n                            friends: friend._id\n                        }\n                    }, {\n                        new: true\n                    }),\n                    _models_User__WEBPACK_IMPORTED_MODULE_1__.User.findByIdAndUpdate(friend._id, {\n                        $pull: {\n                            friends: user._id\n                        }\n                    }, {\n                        new: true\n                    })\n                ]);\n                if (!updatedUser || !updatedFriend) {\n                    throw new Error(\"Failed to update user or friend\");\n                }\n                return res.status(200).json({\n                    message: \"Friend removed successfully\"\n                });\n            } catch (error) {\n                console.error(\"Error handling friend request/removal:\", error);\n                return res.status(500).json({\n                    message: \"Error processing friend operation\"\n                });\n            }\n        }\n    } catch (error) {\n        console.error(\"Friends operation error:\", error);\n        return res.status(500).json({\n            message: \"Error processing friends operation\"\n        });\n    }\n}\nfunction withAuth(req, res) {\n    return (0,_middleware_auth__WEBPACK_IMPORTED_MODULE_2__.authMiddleware)(req, res, ()=>handler(req, res));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFDdkUsRUFBRSxPQUFPQyxPQUFPO2dCQUNkUCxRQUFRTyxLQUFLLENBQUMsMENBQTBDQTtnQkFDeEQsT0FBT1IsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztnQkFBb0M7WUFDN0U7UUFDRjtJQUNGLEVBQUUsT0FBT0MsT0FBTztRQUNkUCxRQUFRTyxLQUFLLENBQUMsNEJBQTRCQTtRQUMxQyxPQUFPUixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBcUM7SUFDOUU7QUFDRjtBQUVlLFNBQVMyRCxTQUN0Qm5FLEdBQXlCLEVBQ3pCQyxHQUFvQjtJQUVwQixPQUFPSCxnRUFBY0EsQ0FBQ0UsS0FBS0MsS0FBSyxJQUFNRixRQUFRQyxLQUFLQztBQUNyRCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhZmV0eS1jaGVjay1uZXR3b3JrLy4vc3JjL3BhZ2VzL2FwaS91c2VyL2ZyaWVuZHMudHM/YTg5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IGRiQ29ubmVjdCBmcm9tICdAL2xpYi9kYic7XHJcbmltcG9ydCB7IFVzZXIsIElVc2VyIH0gZnJvbSAnQC9tb2RlbHMvVXNlcic7XHJcbmltcG9ydCB7IGF1dGhNaWRkbGV3YXJlLCBBdXRoZW50aWNhdGVkUmVxdWVzdCB9IGZyb20gJ0AvbWlkZGxld2FyZS9hdXRoJztcclxuaW1wb3J0IHsgVHlwZXMgfSBmcm9tICdtb25nb29zZSc7XHJcbmltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XHJcblxyXG5pbnRlcmZhY2UgUG9wdWxhdGVkVXNlciBleHRlbmRzIE9taXQ8SVVzZXIsICdmcmllbmRzJyB8ICdmcmllbmRSZXF1ZXN0cyc+IHtcclxuICBfaWQ6IFR5cGVzLk9iamVjdElkO1xyXG4gIGZyaWVuZHM6IEFycmF5PHtcclxuICAgIF9pZDogVHlwZXMuT2JqZWN0SWQ7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICB1c2VybmFtZTogc3RyaW5nO1xyXG4gICAgZW1haWw6IHN0cmluZztcclxuICAgIGxhc3RDaGVja0luOiBEYXRlIHwgbnVsbDtcclxuICB9PjtcclxuICBmcmllbmRSZXF1ZXN0czogQXJyYXk8e1xyXG4gICAgZnJvbToge1xyXG4gICAgICBfaWQ6IFR5cGVzLk9iamVjdElkO1xyXG4gICAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAgIHVzZXJuYW1lOiBzdHJpbmc7XHJcbiAgICAgIGVtYWlsOiBzdHJpbmc7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlZEF0OiBEYXRlO1xyXG4gIH0+O1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxyXG4gIHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2VcclxuKSB7XHJcbiAgY29uc29sZS5sb2coJ0ZyaWVuZHMgQVBJIGNhbGxlZCB3aXRoIG1ldGhvZDonLCByZXEubWV0aG9kKTtcclxuXHJcbiAgaWYgKCFbJ0dFVCcsICdQT1NUJywgJ0RFTEVURScsICdQVVQnXS5pbmNsdWRlcyhyZXEubWV0aG9kIHx8ICcnKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgbWVzc2FnZTogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgLy8gQ29ubmVjdCB0byBkYXRhYmFzZVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byBNb25nb0RCLi4uJyk7XHJcbiAgICAgIGF3YWl0IGRiQ29ubmVjdCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byBNb25nb0RCJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgICAgbWVzc2FnZTogJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyxcclxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFyZXEudXNlcikge1xyXG4gICAgICBjb25zb2xlLmxvZygnTm8gdXNlciBmb3VuZCBpbiByZXF1ZXN0Jyk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdOb3QgYXV0aGVudGljYXRlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1VzZXIgZm91bmQgaW4gcmVxdWVzdDonLCByZXEudXNlci5faWQpO1xyXG4gICAgY29uc3QgdXNlciA9IHJlcS51c2VyIGFzIElVc2VyICYgeyBfaWQ6IFR5cGVzLk9iamVjdElkIH07XHJcblxyXG4gICAgLy8gR0VUOiBGZXRjaCBmcmllbmRzIGxpc3QgYW5kIGZyaWVuZCByZXF1ZXN0c1xyXG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gRmlyc3QgdHJ5IHRvIGZpbmQgdGhlIHVzZXIgd2l0aG91dCBwb3B1bGF0aW9uIHRvIGVuc3VyZSB0aGV5IGV4aXN0XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0xvb2tpbmcgdXAgdXNlcjonLCB1c2VyLl9pZCk7XHJcbiAgICAgICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5faWQpO1xyXG4gICAgICAgIGlmICghdXNlckV4aXN0cykge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignVXNlciBub3QgZm91bmQgaW4gZGF0YWJhc2U6JywgdXNlci5faWQpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHVzZXIgaW4gZGF0YWJhc2UnKTtcclxuXHJcbiAgICAgICAgLy8gVGhlbiBwb3B1bGF0ZSB0aGUgZGF0YVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdQb3B1bGF0aW5nIHVzZXIgZGF0YS4uLicpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJXaXRoRGF0YSA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5faWQpXHJcbiAgICAgICAgICAucG9wdWxhdGUoe1xyXG4gICAgICAgICAgICBwYXRoOiAnZnJpZW5kcycsXHJcbiAgICAgICAgICAgIHNlbGVjdDogJ25hbWUgZW1haWwgdXNlcm5hbWUgbGFzdENoZWNrSW4nXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLnBvcHVsYXRlKHtcclxuICAgICAgICAgICAgcGF0aDogJ2ZyaWVuZFJlcXVlc3RzLmZyb20nLFxyXG4gICAgICAgICAgICBzZWxlY3Q6ICduYW1lIGVtYWlsIHVzZXJuYW1lJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoJ2ZyaWVuZHMgZnJpZW5kUmVxdWVzdHMnKVxyXG4gICAgICAgICAgLmxlYW4oKSBhcyBQb3B1bGF0ZWRVc2VyIHwgbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyV2l0aERhdGEpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwb3B1bGF0ZSB1c2VyIGRhdGE6JywgdXNlci5faWQpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCB1c2VyIGRhdGEnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IHBvcHVsYXRlZCB1c2VyIGRhdGEnKTtcclxuXHJcbiAgICAgICAgLy8gU2FmZWx5IG1hcCBmcmllbmRzIHdpdGggZXJyb3IgaGFuZGxpbmdcclxuICAgICAgICBjb25zb2xlLmxvZygnUmF3IGZyaWVuZHMgZGF0YTonLCB1c2VyV2l0aERhdGEuZnJpZW5kcyk7XHJcbiAgICAgICAgY29uc3QgZnJpZW5kcyA9ICh1c2VyV2l0aERhdGEuZnJpZW5kcyB8fCBbXSlcclxuICAgICAgICAgIC5maWx0ZXIoZnJpZW5kID0+IGZyaWVuZCAmJiBmcmllbmQuX2lkKVxyXG4gICAgICAgICAgLm1hcChmcmllbmQgPT4gKHtcclxuICAgICAgICAgICAgaWQ6IGZyaWVuZC5faWQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgbmFtZTogZnJpZW5kLm5hbWUsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiBmcmllbmQudXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiBmcmllbmQuZW1haWwsXHJcbiAgICAgICAgICAgIGxhc3RDaGVja0luOiBmcmllbmQubGFzdENoZWNrSW4sXHJcbiAgICAgICAgICB9KSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3NlZCBmcmllbmRzOicsIGZyaWVuZHMubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgLy8gU2FmZWx5IG1hcCBmcmllbmQgcmVxdWVzdHMgd2l0aCBlcnJvciBoYW5kbGluZ1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdSYXcgZnJpZW5kIHJlcXVlc3RzIGRhdGE6JywgdXNlcldpdGhEYXRhLmZyaWVuZFJlcXVlc3RzKTtcclxuICAgICAgICBjb25zdCBmcmllbmRSZXF1ZXN0cyA9ICh1c2VyV2l0aERhdGEuZnJpZW5kUmVxdWVzdHMgfHwgW10pXHJcbiAgICAgICAgICAuZmlsdGVyKHJlcXVlc3QgPT4gcmVxdWVzdCAmJiByZXF1ZXN0LmZyb20gJiYgcmVxdWVzdC5mcm9tLl9pZClcclxuICAgICAgICAgIC5tYXAocmVxdWVzdCA9PiAoe1xyXG4gICAgICAgICAgICBpZDogcmVxdWVzdC5mcm9tLl9pZC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICBuYW1lOiByZXF1ZXN0LmZyb20ubmFtZSxcclxuICAgICAgICAgICAgdXNlcm5hbWU6IHJlcXVlc3QuZnJvbS51c2VybmFtZSxcclxuICAgICAgICAgICAgZW1haWw6IHJlcXVlc3QuZnJvbS5lbWFpbCxcclxuICAgICAgICAgICAgY3JlYXRlZEF0OiByZXF1ZXN0LmNyZWF0ZWRBdCxcclxuICAgICAgICAgIH0pKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2VkIGZyaWVuZCByZXF1ZXN0czonLCBmcmllbmRSZXF1ZXN0cy5sZW5ndGgpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBmcmllbmRzLCBmcmllbmRSZXF1ZXN0cyB9KTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBmcmllbmRzIGFuZCByZXF1ZXN0czonLCBlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgICAgICBtZXNzYWdlOiAnRXJyb3IgZmV0Y2hpbmcgZnJpZW5kcyBhbmQgcmVxdWVzdHMnLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IHVzZXJuYW1lIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoIXVzZXJuYW1lKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdVc2VybmFtZSBpcyByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUE9TVDogU2VuZCBhIGZyaWVuZCByZXF1ZXN0XHJcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgZnJpZW5kIGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IGZyaWVuZCA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHVzZXJuYW1lOiB1c2VybmFtZS50b0xvd2VyQ2FzZSgpIH0pO1xyXG4gICAgICAgIGlmICghZnJpZW5kKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2FuJ3QgYWRkIHlvdXJzZWxmXHJcbiAgICAgICAgaWYgKGZyaWVuZC5faWQudG9TdHJpbmcoKSA9PT0gdXNlci5faWQudG9TdHJpbmcoKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhZGQgeW91cnNlbGYgYXMgYSBmcmllbmQnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSBmcmllbmRzXHJcbiAgICAgICAgY29uc3QgYXJlRnJpZW5kcyA9IHVzZXIuZnJpZW5kcy5zb21lKFxyXG4gICAgICAgICAgKGZyaWVuZElkOiBUeXBlcy5PYmplY3RJZCkgPT4gZnJpZW5kSWQudG9TdHJpbmcoKSA9PT0gZnJpZW5kLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoYXJlRnJpZW5kcykge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0FscmVhZHkgZnJpZW5kcycgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBmcmllbmQgcmVxdWVzdCBhbHJlYWR5IHNlbnRcclxuICAgICAgICBjb25zdCBleGlzdGluZ1JlcXVlc3QgPSBmcmllbmQuZnJpZW5kUmVxdWVzdHMuZmluZChcclxuICAgICAgICAgIChyZXF1ZXN0OiBhbnkpID0+IHJlcXVlc3QuZnJvbS50b1N0cmluZygpID09PSB1c2VyLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoZXhpc3RpbmdSZXF1ZXN0KSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnRnJpZW5kIHJlcXVlc3QgYWxyZWFkeSBzZW50JyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZXkgc2VudCB5b3UgYSByZXF1ZXN0XHJcbiAgICAgICAgY29uc3QgdGhlaXJSZXF1ZXN0ID0gdXNlci5mcmllbmRSZXF1ZXN0cy5maW5kKFxyXG4gICAgICAgICAgKHJlcXVlc3Q6IGFueSkgPT4gcmVxdWVzdC5mcm9tLnRvU3RyaW5nKCkgPT09IGZyaWVuZC5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKHRoZWlyUmVxdWVzdCkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIHVzZXIgaGFzIGFscmVhZHkgc2VudCB5b3UgYSBmcmllbmQgcmVxdWVzdC4gQ2hlY2sgeW91ciBmcmllbmQgcmVxdWVzdHMgdG8gYWNjZXB0IGl0LidcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQWRkIGZyaWVuZCByZXF1ZXN0XHJcbiAgICAgICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShmcmllbmQuX2lkLCB7XHJcbiAgICAgICAgICAkcHVzaDogeyBcclxuICAgICAgICAgICAgZnJpZW5kUmVxdWVzdHM6IHtcclxuICAgICAgICAgICAgICBmcm9tOiB1c2VyLl9pZCxcclxuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LCB7IG5ldzogdHJ1ZSB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgICAgICBtZXNzYWdlOiAnRnJpZW5kIHJlcXVlc3Qgc2VudCBzdWNjZXNzZnVsbHknXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2VuZGluZyBmcmllbmQgcmVxdWVzdDonLCBlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0Vycm9yIHNlbmRpbmcgZnJpZW5kIHJlcXVlc3QnIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUFVUOiBBY2NlcHQgYSBmcmllbmQgcmVxdWVzdFxyXG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdQVVQnKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1xcbj09PSBTVEFSVDogRnJpZW5kIFJlcXVlc3QgQWNjZXB0YW5jZSA9PT0nKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnUmF3IHJlcXVlc3QgYm9keTonLCBKU09OLnN0cmluZ2lmeShyZXEuYm9keSkpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVc2VybmFtZSBmcm9tIHJlcXVlc3Q6JywgdXNlcm5hbWUpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IHVzZXIgSUQ6JywgdXNlci5faWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEZpcnN0IGdldCB0aGUgZnVsbHkgcG9wdWxhdGVkIHVzZXIgZG9jdW1lbnRcclxuICAgICAgICBjb25zb2xlLmxvZygnXFxuRmV0Y2hpbmcgY3VycmVudCB1c2VyIHdpdGggcG9wdWxhdGVkIGRhdGEuLi4nKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50VXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5faWQpXHJcbiAgICAgICAgICAucG9wdWxhdGUoe1xyXG4gICAgICAgICAgICBwYXRoOiAnZnJpZW5kUmVxdWVzdHMuZnJvbScsXHJcbiAgICAgICAgICAgIHNlbGVjdDogJ25hbWUgZW1haWwgdXNlcm5hbWUnXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmxlYW4oKVxyXG4gICAgICAgICAgLmV4ZWMoKSBhcyB1bmtub3duIGFzIHtcclxuICAgICAgICAgICAgX2lkOiBUeXBlcy5PYmplY3RJZDtcclxuICAgICAgICAgICAgZnJpZW5kUmVxdWVzdHM6IEFycmF5PHtcclxuICAgICAgICAgICAgICBfaWQ6IFR5cGVzLk9iamVjdElkO1xyXG4gICAgICAgICAgICAgIGZyb206IHtcclxuICAgICAgICAgICAgICAgIF9pZDogVHlwZXMuT2JqZWN0SWQ7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgZW1haWw6IHN0cmluZztcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGNyZWF0ZWRBdDogRGF0ZTtcclxuICAgICAgICAgICAgfT47XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignQ291bGQgbm90IGZpbmQgY3VycmVudCB1c2VyIHdpdGggcG9wdWxhdGVkIGRhdGEnKTtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdFcnJvciBsb2FkaW5nIHVzZXIgZGF0YScgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb2cgdGhlIGZ1bGwgdXNlciBvYmplY3QgZm9yIGRlYnVnZ2luZ1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdcXG5DdXJyZW50IHVzZXIgZGF0YTonLCBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBfaWQ6IGN1cnJlbnRVc2VyLl9pZCxcclxuICAgICAgICAgIGZyaWVuZFJlcXVlc3RzOiBjdXJyZW50VXNlci5mcmllbmRSZXF1ZXN0cyxcclxuICAgICAgICB9LCBudWxsLCAyKSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdcXG5Mb29raW5nIGZvciBmcmllbmQgd2l0aCB1c2VybmFtZTonLCB1c2VybmFtZSk7XHJcbiAgICAgICAgY29uc3QgZnJpZW5kID0gYXdhaXQgVXNlci5maW5kT25lKHsgdXNlcm5hbWU6IHVzZXJuYW1lLnRvTG93ZXJDYXNlKCkgfSk7XHJcbiAgICAgICAgaWYgKCFmcmllbmQpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdGcmllbmQgbm90IGZvdW5kIHdpdGggdXNlcm5hbWU6JywgdXNlcm5hbWUpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIGZyaWVuZDonLCB7XHJcbiAgICAgICAgICBpZDogZnJpZW5kLl9pZCxcclxuICAgICAgICAgIHVzZXJuYW1lOiBmcmllbmQudXNlcm5hbWVcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgcGVuZGluZyByZXF1ZXN0IGJ5IGNvbXBhcmluZyB1c2VybmFtZXNcclxuICAgICAgICBjb25zb2xlLmxvZygnXFxuQ2hlY2tpbmcgZm9yIHBlbmRpbmcgcmVxdWVzdC4uLicpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgb2YgZnJpZW5kIHJlcXVlc3RzOicsIGN1cnJlbnRVc2VyLmZyaWVuZFJlcXVlc3RzPy5sZW5ndGggfHwgMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgcGVuZGluZ1JlcXVlc3QgPSBjdXJyZW50VXNlci5mcmllbmRSZXF1ZXN0cz8uZmluZCgocmVxdWVzdCkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHJlcXVlc3QuZnJvbS51c2VybmFtZS50b0xvd2VyQ2FzZSgpID09PSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ0NoZWNraW5nIHJlcXVlc3Q6Jywge1xyXG4gICAgICAgICAgICBmcm9tVXNlcm5hbWU6IHJlcXVlc3QuZnJvbS51c2VybmFtZSxcclxuICAgICAgICAgICAgdGFyZ2V0VXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICBtYXRjaGVzXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHJldHVybiBtYXRjaGVzO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIXBlbmRpbmdSZXF1ZXN0KSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnXFxuTm8gcGVuZGluZyByZXF1ZXN0IGZvdW5kLiBBbGwgY3VycmVudCByZXF1ZXN0czonLCBcclxuICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoY3VycmVudFVzZXIuZnJpZW5kUmVxdWVzdHM/Lm1hcCgocikgPT4gKHtcclxuICAgICAgICAgICAgICBmcm9tVXNlcm5hbWU6IHIuZnJvbS51c2VybmFtZSxcclxuICAgICAgICAgICAgICBmcm9tSWQ6IHIuZnJvbS5faWRcclxuICAgICAgICAgICAgfSkpLCBudWxsLCAyKVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdObyBmcmllbmQgcmVxdWVzdCBmb3VuZCBmcm9tIHRoaXMgdXNlcicgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnXFxuRm91bmQgcGVuZGluZyByZXF1ZXN0OicsIHtcclxuICAgICAgICAgIGZyb206IHtcclxuICAgICAgICAgICAgaWQ6IHBlbmRpbmdSZXF1ZXN0LmZyb20uX2lkLFxyXG4gICAgICAgICAgICB1c2VybmFtZTogcGVuZGluZ1JlcXVlc3QuZnJvbS51c2VybmFtZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgdGhlIHJlcXVlc3QgYW5kIGFkZCB0byBmcmllbmRzIGZvciBib3RoIHVzZXJzXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1xcblVwZGF0aW5nIGJvdGggdXNlcnMuLi4nKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXBkYXRlIHF1ZXJ5OicsIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICRwdWxsOiB7ICdmcmllbmRSZXF1ZXN0cyc6IHsgJ2Zyb20nOiBmcmllbmQuX2lkIH0gfSxcclxuICAgICAgICAgICRhZGRUb1NldDogeyBmcmllbmRzOiBmcmllbmQuX2lkIH1cclxuICAgICAgICB9LCBudWxsLCAyKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgW3VwZGF0ZWRVc2VyLCB1cGRhdGVkRnJpZW5kXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgIFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoXHJcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyLl9pZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICRwdWxsOiB7ICdmcmllbmRSZXF1ZXN0cyc6IHsgJ2Zyb20nOiBmcmllbmQuX2lkIH0gfSxcclxuICAgICAgICAgICAgICAkYWRkVG9TZXQ6IHsgZnJpZW5kczogZnJpZW5kLl9pZCB9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IFxyXG4gICAgICAgICAgICAgIG5ldzogdHJ1ZSxcclxuICAgICAgICAgICAgICBydW5WYWxpZGF0b3JzOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICkucG9wdWxhdGUoJ2ZyaWVuZHMnLCAnbmFtZSBlbWFpbCB1c2VybmFtZSBsYXN0Q2hlY2tJbicpLFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICBmcmllbmQuX2lkLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgJGFkZFRvU2V0OiB7IGZyaWVuZHM6IGN1cnJlbnRVc2VyLl9pZCB9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IFxyXG4gICAgICAgICAgICAgIG5ldzogdHJ1ZSxcclxuICAgICAgICAgICAgICBydW5WYWxpZGF0b3JzOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIClcclxuICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgaWYgKCF1cGRhdGVkVXNlciB8fCAhdXBkYXRlZEZyaWVuZCkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignXFxuRmFpbGVkIHRvIHVwZGF0ZSBkb2N1bWVudHM6Jywge1xyXG4gICAgICAgICAgICB1cGRhdGVkVXNlcjogISF1cGRhdGVkVXNlcixcclxuICAgICAgICAgICAgdXBkYXRlZEZyaWVuZDogISF1cGRhdGVkRnJpZW5kXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHVwZGF0ZSB1c2VyIG9yIGZyaWVuZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1xcblN1Y2Nlc3NmdWxseSB1cGRhdGVkIGJvdGggdXNlcnMnKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXBkYXRlZCB1c2VyIGZyaWVuZHM6JywgdXBkYXRlZFVzZXIuZnJpZW5kcyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJz09PSBFTkQ6IEZyaWVuZCBSZXF1ZXN0IEFjY2VwdGFuY2UgPT09XFxuJyk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICAgICAgbWVzc2FnZTogJ0ZyaWVuZCByZXF1ZXN0IGFjY2VwdGVkJyxcclxuICAgICAgICAgIGZyaWVuZDoge1xyXG4gICAgICAgICAgICBpZDogZnJpZW5kLl9pZCxcclxuICAgICAgICAgICAgbmFtZTogZnJpZW5kLm5hbWUsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiBmcmllbmQudXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiBmcmllbmQuZW1haWwsXHJcbiAgICAgICAgICAgIGxhc3RDaGVja0luOiBmcmllbmQubGFzdENoZWNrSW4sXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWNjZXB0aW5nIGZyaWVuZCByZXF1ZXN0OicsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRXJyb3IgYWNjZXB0aW5nIGZyaWVuZCByZXF1ZXN0JyB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIERFTEVURTogUmVqZWN0IGEgZnJpZW5kIHJlcXVlc3Qgb3IgcmVtb3ZlIGEgZnJpZW5kXHJcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0RFTEVURScpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBmcmllbmQgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB1c2VybmFtZTogdXNlcm5hbWUudG9Mb3dlckNhc2UoKSB9KTtcclxuICAgICAgICBpZiAoIWZyaWVuZCkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBmcmllbmQgcmVxdWVzdCByZWplY3Rpb25cclxuICAgICAgICBjb25zdCByZXF1ZXN0SW5kZXggPSB1c2VyLmZyaWVuZFJlcXVlc3RzLmZpbmRJbmRleChcclxuICAgICAgICAgIChyZXF1ZXN0OiBhbnkpID0+IHJlcXVlc3QuZnJvbS50b1N0cmluZygpID09PSBmcmllbmQuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAocmVxdWVzdEluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgLy8gUmVqZWN0IGZyaWVuZCByZXF1ZXN0XHJcbiAgICAgICAgICBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICB1c2VyLl9pZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICRwdWxsOiB7IGZyaWVuZFJlcXVlc3RzOiB7IGZyb206IGZyaWVuZC5faWQgfSB9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IG5ldzogdHJ1ZSB9XHJcbiAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGcmllbmQgcmVxdWVzdCByZWplY3RlZCcgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZiBub3QgYSByZXF1ZXN0LCByZW1vdmUgZnJvbSBmcmllbmRzIGxpc3RcclxuICAgICAgICBjb25zdCBbdXBkYXRlZFVzZXIsIHVwZGF0ZWRGcmllbmRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgICAgICAgICAgdXNlci5faWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAkcHVsbDogeyBmcmllbmRzOiBmcmllbmQuX2lkIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgbmV3OiB0cnVlIH1cclxuICAgICAgICAgICksXHJcbiAgICAgICAgICBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICBmcmllbmQuX2lkLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgJHB1bGw6IHsgZnJpZW5kczogdXNlci5faWQgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICBpZiAoIXVwZGF0ZWRVc2VyIHx8ICF1cGRhdGVkRnJpZW5kKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgdXNlciBvciBmcmllbmQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdGcmllbmQgcmVtb3ZlZCBzdWNjZXNzZnVsbHknIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIGZyaWVuZCByZXF1ZXN0L3JlbW92YWw6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdFcnJvciBwcm9jZXNzaW5nIGZyaWVuZCBvcGVyYXRpb24nIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZyaWVuZHMgb3BlcmF0aW9uIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdFcnJvciBwcm9jZXNzaW5nIGZyaWVuZHMgb3BlcmF0aW9uJyB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHdpdGhBdXRoKFxyXG4gIHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2VcclxuKSB7XHJcbiAgcmV0dXJuIGF1dGhNaWRkbGV3YXJlKHJlcSwgcmVzLCAoKSA9PiBoYW5kbGVyKHJlcSwgcmVzKSk7XHJcbn0gIl0sIm5hbWVzIjpbImRiQ29ubmVjdCIsIlVzZXIiLCJhdXRoTWlkZGxld2FyZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJjb25zb2xlIiwibG9nIiwibWV0aG9kIiwiaW5jbHVkZXMiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImVycm9yIiwiRXJyb3IiLCJ1c2VyIiwiX2lkIiwidXNlckV4aXN0cyIsImZpbmRCeUlkIiwidXNlcldpdGhEYXRhIiwicG9wdWxhdGUiLCJwYXRoIiwic2VsZWN0IiwibGVhbiIsImZyaWVuZHMiLCJmaWx0ZXIiLCJmcmllbmQiLCJtYXAiLCJpZCIsInRvU3RyaW5nIiwibmFtZSIsInVzZXJuYW1lIiwiZW1haWwiLCJsYXN0Q2hlY2tJbiIsImxlbmd0aCIsImZyaWVuZFJlcXVlc3RzIiwicmVxdWVzdCIsImZyb20iLCJjcmVhdGVkQXQiLCJib2R5IiwiZmluZE9uZSIsInRvTG93ZXJDYXNlIiwiYXJlRnJpZW5kcyIsInNvbWUiLCJmcmllbmRJZCIsImV4aXN0aW5nUmVxdWVzdCIsImZpbmQiLCJ0aGVpclJlcXVlc3QiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdXNoIiwiRGF0ZSIsIm5ldyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjdXJyZW50VXNlciIsImV4ZWMiLCJwZW5kaW5nUmVxdWVzdCIsIm1hdGNoZXMiLCJmcm9tVXNlcm5hbWUiLCJ0YXJnZXRVc2VybmFtZSIsInIiLCJmcm9tSWQiLCIkcHVsbCIsIiRhZGRUb1NldCIsInVwZGF0ZWRVc2VyIiwidXBkYXRlZEZyaWVuZCIsIlByb21pc2UiLCJhbGwiLCJydW5WYWxpZGF0b3JzIiwicmVxdWVzdEluZGV4IiwiZmluZEluZGV4Iiwid2l0aEF1dGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/user/friends.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fuser%2Ffriends&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cuser%5Cfriends.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();